# -*- coding: utf-8 -*-
"""dataset_prep.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1Dy2BKwzpxFAnHyNfwoB68YMnP0Ya6RcG
"""

import os
import shutil
from tqdm import tqdm
import open3d as o3d
import numpy as np

l1_dir = os.listdir('./Preprocessed')

l2_dir = []

for i in tqdm(l1_dir):
    if i == ".DS_Store":
        continue
    try:
        os.mkdir(f"./Preprocessed_1/{i}")
        os.mkdir(f"./Preprocessed_1/{i}/Embeddings")
    except:
         pass

    arr = np.asarray(o3d.io.read_point_cloud(f'./Preprocessed/{i}/mesh.ply').points).flatten()
    try:
        np.save(f'Preprocessed_1/{i}/mesh.npy', arr)
    except:
        print('Didnt Save')
    # shutil.copy(f'./Preprocessed/{i}/mesh.ply', f'./Preprocessed_1/{i}')
    for j in os.listdir(f"./Preprocessed/{i}/Embeddings"):
        shutil.copy(f'./Preprocessed/{i}/Embeddings/{j}', f'./Preprocessed_1/{i}/Embeddings')